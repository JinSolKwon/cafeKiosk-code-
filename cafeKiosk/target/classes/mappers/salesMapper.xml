<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="salesDao">
	
	<!-- 오늘 주문 수 가져오기 -->
	<select id="todayOrderCount" resultType="int">
		select count(*)	from ORDER_LIST WHERE TO_CHAR(ORDER_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD')	
	</select>
	
	<!-- 오늘 주문 목록 가져오기 -->
	<select id="todayOrderList" resultType="salesVo">
      select * from (select rownum RNUM, NUM, ORDER_NUM as orderNum, MENU, TEMPERATURE, BEVERAGE_SIZE as beverageSize, 
      		SHOT, SYRUB, WHIPPING, PRICE, ORDER_DATE as orderDate 
      		from (select * from ORDER_LIST 
      		where TO_CHAR(ORDER_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') order by NUM asc)) A,
		  	(select ORDER_NUM, MEMBER_NUM as memberNum, POINT, CARD, CASH, TOTAL, PROVISION, REFUND from PAYMENT where
		  	TO_CHAR(ORDER_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD')) B
		  where B.ORDER_NUM = A.orderNum
	</select>
	
	<!-- 오늘 매출 정보 목록 가져오기 -->
	<select id="todaySalesList" resultType="salesVo">
		select NUM,ORDER_NUM, MEMBER_NUM as memberNum, POINT, CARD, CASH, TOTAL, PROVISION, REFUND from PAYMENT where
		  	TO_CHAR(ORDER_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD')
	</select>
	
	<!-- 오늘 매출 가장 최근 자료 하나 가져오기 -->
	<select id="lastSales" resultType="salesVo">
		select NUM,ORDER_NUM, MEMBER_NUM as memberNum, POINT, CARD, CASH, TOTAL, PROVISION, REFUND from PAYMENT where
		  	TO_CHAR(ORDER_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') and ORDER_NUM = #{value}
	</select>
	
	<!-- 기간 매출 합계  -->
	<select id="periodSalesSum" parameterType="HashMap" resultType="salesVo">
	select sum(total) as total,sum(point) as point,sum(cash) as cash,sum(card) as card
   		from PAYMENT
    	<choose>
    		<when test="startDate==null or startDate.equals('')">
    			where TO_CHAR(ORDER_DATE,'YYYYMMDD') between TRUNC(SYSDATE, 'MM') and TO_CHAR(SYSDATE,'YYYYMMDD')+0.99999
    		</when>
    		<otherwise>
    			where ORDER_DATE between to_date(#{startDate}, 'YYYY-MM-DD') and to_date(#{endDate},'YYYY-MM-DD')+0.99999
    		</otherwise>
    	</choose>
    </select>
    
    <!-- 기간 환불 합계 -->
    <select id="periodRefundSum" parameterType="HashMap" resultType="salesVo">
	select sum(total) as total,sum(point) as point,sum(cash) as cash,sum(card) as card
    	from PAYMENT
    	<choose>
    		<when test="startDate==null or startDate.equals('')">
    			where TO_CHAR(ORDER_DATE,'YYYYMMDD') between TRUNC(SYSDATE, 'MM') and TO_CHAR(SYSDATE,'YYYYMMDD')+0.99999
    		</when>
    		<otherwise>
    			where ORDER_DATE between to_date(#{startDate}, 'YYYY-MM-DD') and to_date(#{endDate},'YYYY-MM-DD')+0.99999
    		</otherwise>
    	</choose>
    	and refund = 'Y'
    </select>
</mapper>